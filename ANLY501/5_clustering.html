<!DOCTYPE HTML>
<html>
<head>
    <title>Jingsong Gao - 501 Portfolio</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css"/>
    <link rel="shortcut icon" href="/icon.png"/>
    <link rel="bookmark" href="/icon.png"/>
</head>

<body>
<div class="headerpage-501"></div>
<div class="main">
    <div class="left-side">
        <div class="left-navi">
            <ul>
                <li class="nav"><p>PC Component</p></li>
                <li class="nav"><a href="#pc-pre">Pre-classification</a></li>
                <li class="nav"><a href="#pc-uneq">Unequal-Len Time Series</a></li>
                <li class="nav"><a href="#pc-eq">Equal-Len Time Series</a></li>
                <li class="nav"><p>Crypto & Commodity</p></li>
                <li class="nav"><a href="#crypto">Crypto Time Series</a></li>
                <li class="nav"><a href="#commodity">Commodity Time Series</a></li>
                <li class="nav"><p>Public View</p></li>
                <li class="nav"><a href="#youtube">Youtube Comments</a></li>
            </ul>
        </div>
    </div>

    <div class="content">
        <h1 style="text-align:center">Clustering</h1>

        <h2>1. PC Component Price Time Series (Python Record Data)</h2>

        <h3>1.1 Pre-classification of PC components</h3>

        <section id="pc-pre">

            <p>The python script for this part is <a
                    href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/blob/master/data_clean/amazon/timeseries_converter.ipynb">data_clean/amazon/timeseries_converter.ipynb</a>.
                All the preprocessed time series can be found at <a
                        href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/tree/master/data/amazon">data/amazon</a>
                folder on GitHub (see below for the definition of each file).</p>

            <p>Data in amazon database is recorded in <b>unequal-interval</b> time series, since Keepa API write a new
                value to their database <b>only</b> when the price changes.</p>

            <p>So, the first step of preprocessing is to rebuild a <b>equal-interval</b> time series from the database.
                <b>Pandas</b> is a useful tool to do this. Since it not only provides an SQL interface but also provides
                a powerful function called <b>resample</b>. With Pandas, historical price data in SQLite database can
                be easily converted into equal-interval time series. <b>After several attempts, the time interval for
                    resampling is assigned to 1 day</b>.</p>

            <table width="100%">
                <caption>File prefix in pre-classified data and their meaning</caption>
                <tr>
                    <th>File Prefix</th>
                    <th>Meaning</th>
                </tr>
                <tr>
                    <td>NEWS</td>
                    <td>price history of the New in marketplace</td>
                </tr>
                <tr>
                    <td>USED</td>
                    <td>price history of the Used in marketplace</td>
                </tr>
                <tr>
                    <td>BUY_BOX</td>
                    <td>price history of the New buy box</td>
                </tr>
                <tr>
                    <td>EBAY_NEW</td>
                    <td>price history of the lowest new price on the respective eBay locale</td>
                </tr>
                <tr>
                    <td>EBAY_USED</td>
                    <td>price history of the lowest used price on the respective eBay locale</td>
                </tr>
            </table>

            <p>Another thing needs to be considered is that Keepa API uses <b>-1</b> as out-of-stock, but these negative
                values will disturb the following clustering. Therefore, all <b>-1</b>s in the time series are filled
                with a previous non-negative value to create a <b>normal price time series</b>.</p>

            <p>But the out-of-stock data does contain some useful information, so a new time series called <b>out-of-stock
                indicator</b> that records the out-of-stock status is created, which all normal prices are converted
                into 0 and out-of-stock values are converted into 1. </p>

            <p>Since the products are released in varied date, some products have data more than 4 years, but some
                products only have data less than 6 months. A pre-classification is performed on the products, all data
                are separated into different files based on their time span. The files are labeled by some suffixes.</p>

            <table width="100%">
                <caption>File suffix in pre-classified data and their meaning</caption>
                <tr>
                    <th>File Suffix</th>
                    <th>Meaning</th>
                </tr>
                <tr>
                    <td>s</td>
                    <td>time span less than 6 months</td>
                </tr>
                <tr>
                    <td>6m</td>
                    <td>time span between 6 months to 1 year</td>
                </tr>
                <tr>
                    <td>1y</td>
                    <td>time span between 1 year to 2 years</td>
                </tr>
                <tr>
                    <td>2y</td>
                    <td>time span between 2 years to 4 years</td>
                </tr>
                <tr>
                    <td>4y</td>
                    <td>time span more than 4 years</td>
                </tr>
                <tr>
                    <td>ts</td>
                    <td>time series, each row contains a time series of normal price separate by space.</td>
                </tr>
                <tr>
                    <td>osts</td>
                    <td>time series, each row contains a time series of out-of-stock indicators separate by space.</td>
                </tr>
                <tr>
                    <td>eqts</td>
                    <td>time series of normal prices but are truncated to same length.</td>
                </tr>
                <tr>
                    <td>eqosts</td>
                    <td>time series of out-of-stock indicators but are truncated to same length.</td>
                </tr>
                <tr>
                    <td>label</td>
                    <td>label, each row contains product type + product name as label</td>
                </tr>
            </table>

            <p>Because some distance metrics in the following clustering require an equal-length time series, so time
                series all have a truncated version. For example, <a
                        href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/blob/master/data/amazon/BUY_BOX_eqts_1y.txt">BUY_BOX_eqts_1y.txt</a>
                contains the same products as <a
                        href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/blob/master/data/amazon/BUY_BOX_ts_1y.txt">BUY_BOX_ts_1y.txt</a>,
                but the time spans of the data are truncated to exactly 1 year.</p>

        </section>

        <h3>1.2 Clustering on unequal-length Time Series (KMeans, metric: DTW, Soft-DTW)</h3>

        <section id="pc-uneq">

            <p>The pre-classified datasets are not unequal-length time series. For example, the length of time series in
                <a href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/blob/master/data/amazon/BUY_BOX_ts_1y.txt">BUY_BOX_ts_1y.txt</a>
                can vary from 360(1 year) to 719(2 year).</p>

            <p>DTW(<a href="https://tslearn.readthedocs.io/en/stable/user_guide/dtw.html">Dynamic Time Warping</a>) is a better
                metric to measure the similarity between time series compare to euclidean metric, especially for unequal-length time series(which euclidean metric is no longer available). The <b>tslearn</b> package provides
                this metric in Python and a time series version of KMeans clustering algorithm. A TimeSeriesKMeans model using DTW metric with n_clusters=8 is trained by the time series in <a href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/blob/master/data/amazon/NEW_ts_1y.txt">NEW_ts_1y.txt</a>. The table of clustering
                results shows below. </p>

            <table style="text-align:center;width:100%">
                <caption>Type of products in each cluster of TimeSeriesKMeans model using DTW metric</caption>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <tr>
                    <th style="text-align:center"></th>
                    <th style="text-align:center">CPU</th>
                    <th style="text-align:center">GPU</th>
                    <th style="text-align:center">Drive</th>
                </tr>
                <tr>
                    <td>Cluster 1</td>
                    <td>2</td>
                    <td><b>16</b></td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Cluster 2</td>
                    <td>5</td>
                    <td></td>
                    <td><b>20</b></td>
                </tr>
                <tr>
                    <td>Cluster 3</td>
                    <td><b>10</b></td>
                    <td>1</td>
                    <td><b>28</b></td>
                </tr>
                <tr>
                    <td>Cluster 4</td>
                    <td>1</td>
                    <td></td>
                    <td><b>6</b></td>
                </tr>
                <tr>
                    <td>Cluster 5</td>
                    <td></td>
                    <td><b>27</b></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Cluster 6</td>
                    <td>4</td>
                    <td><b>14</b></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Cluster 7</td>
                    <td>3</td>
                    <td>2</td>
                    <td><b>12</b></td>
                </tr>
                <tr>
                    <td>Cluster 8</td>
                    <td>6</td>
                    <td>4</td>
                    <td><b>28</b></td>
                </tr>
            </table>

            <p>The visualization of clusters shows below.</p>

            <img style="width:95%" class="centerfig" src="picture/cluster/new_1y_dtw_8.png">
            <figurecaption>Figure: visualization of clusters in TimeSeriesKMeans model using DTW metric</figurecaption>

            <p>Some patterns can be found in the clustering table and visualization: </p>
            <p>(1) Cluster 1,5,6 are both GPU-dominated clusters, they all show increasing trends in price which indicates an abnormal impact on their prices.</p>
            <p>(2) Cluster 2,3,7,8 are both drive-dominated clusters, they all follow a normal decreasing trend in price which occurs in most goods.</p>
            <p>(3) There's no CPU-dominated cluster, but most CPUs(25) follow the normal decreasing trend and only 6 CPUs follow the abnormal increasing trend.</p>

            <p>The cluster centers of DTW metric are kind of sharp that have many sudden jumps. A variant of DTW names <a href="https://tslearn.readthedocs.io/en/stable/user_guide/dtw.html#soft-dtw">soft-DTW</a> gives much smoother cluster centers. A TimeSeriesKMeans model using soft-DTW metric with n_clusters=6 is trained by the same time series. The table of cluster result shows below.</p>

            <table style="text-align:center;width:100%">
                <caption>Type of products in each cluster of TimeSeriesKMeans model using soft-DTW metric</caption>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <tr>
                    <th style="text-align:center"></th>
                    <th style="text-align:center">CPU</th>
                    <th style="text-align:center">GPU</th>
                    <th style="text-align:center">Drive</th>
                </tr>
                <tr>
                    <td>Cluster 1</td>
                    <td>1</td>
                    <td><b>26</b></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Cluster 2</td>
                    <td><b>15</b></td>
                    <td>3</td>
                    <td><b>40</b></td>
                </tr>
                <tr>
                    <td>Cluster 3</td>
                    <td>8</td>
                    <td>4</td>
                    <td><b>38</b></td>
                </tr>
                <tr>
                    <td>Cluster 4</td>
                    <td>1</td>
                    <td><b>17</b></td>
                    <td></td>
                </tr>
                <tr>
                    <td>Cluster 5</td>
                    <td>5</td>
                    <td></td>
                    <td><b>16</b></td>
                </tr>
                <tr>
                    <td>Cluster 6</td>
                    <td>1</td>
                    <td><b>14</b></td>
                    <td></td>
                </tr>
            </table>

            <p>The visualization of clusters shows below.</p>

            <img style="width:95%" class="centerfig" src="picture/cluster/new_1y_softdtw_6.png">
            <figurecaption>Figure: visualization of clusters in TimeSeriesKMeans model using soft-DTW metric</figurecaption>

            <p>Similar patterns can be found in this model: </p>
            <p>(1) Cluster 1,4,6 are both GPU-dominated clusters, they all show increasing trends in price which indicates an abnormal impact on their prices.</p>
            <p>(2) Cluster 2,3,5 are both drive-dominated clusters, they all follow a normal decreasing trend in price which occurs in most goods.</p>
            <p>(3) There's no CPU-dominated cluster, but most CPUs(28) follow the normal decreasing trend and only 3 CPUs follow the abnormal increasing trend.</p>
            <p>(4) The cluster centers are much smoother that the trends are clearly shown from them.</p>

        </section>


        <h3>1.3 Clustering on equal-length Time Series (KMeans, metric: Euclidean, Cross-correlation)</h3>

        <section id="pc-eq">

            <p>Some metrics like euclidean and cross correlation in tslearn need equal-length time series as input. First, a TimeSeriesKMeans model using euclidean metric with n_clusters=6 is trained by the time series in <a href="https://github.com/jingshenSN2/GU-ANLY-501-FALL-2021/blob/master/data/amazon/NEW_eqts_1y.txt">NEW_eqts_1y.txt</a>. The table of cluster result shows below.</p>

            <table style="text-align:center;width:100%">
                <caption>Type of products in each cluster of TimeSeriesKMeans model using euclidean metric</caption>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <tr>
                    <th style="text-align:center"></th>
                    <th style="text-align:center">CPU</th>
                    <th style="text-align:center">GPU</th>
                    <th style="text-align:center">Drive</th>
                </tr>
                <tr>
                    <td>Cluster 1</td>
                    <td>1</td>
                    <td><b>14</b></td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Cluster 2</td>
                    <td><b>14</b></td>
                    <td>2</td>
                    <td><b>44</b></td>
                </tr>
                <tr>
                    <td>Cluster 3</td>
                    <td>8</td>
                    <td>4</td>
                    <td><b>38</b></td>
                </tr>
                <tr>
                    <td>Cluster 4</td>
                    <td>1</td>
                    <td><b>26</b></td>
                    <td>2</td>
                </tr>
                <tr>
                    <td>Cluster 5</td>
                    <td>1</td>
                    <td>1</td>
                    <td><b>19</b></td>
                </tr>
                <tr>
                    <td>Cluster 6</td>
                    <td>1</td>
                    <td><b>18</b></td>
                    <td></td>
                </tr>
            </table>

            <p>The visualization of clusters shows below.</p>

            <img style="width:95%" class="centerfig" src="picture/cluster/new_1y_euclidean_6.png">
            <figurecaption>Figure: visualization of clusters in TimeSeriesKMeans model using euclidean metric</figurecaption>

            <p>This model gives a very similar clustering result with the DTW model and soft-DTW model. But the smoothness of cluster centers are between two DTW models.</p>

            <p>Then, a KShape model using cross-correlation metric with n_clusters=4 is trained by the same time series. The table of cluster result shows below.</p>

            <table style="text-align:center;width:100%">
                <caption>Type of products in each cluster of KShape model using cross-correlation metric</caption>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <col width=25%>
                <tr>
                    <th style="text-align:center"></th>
                    <th style="text-align:center">CPU</th>
                    <th style="text-align:center">GPU</th>
                    <th style="text-align:center">Drive</th>
                </tr>
                <tr>
                    <td>Cluster 1</td>
                    <td><b>17</b></td>
                    <td></td>
                    <td><b>16</b></td>
                </tr>
                <tr>
                    <td>Cluster 2</td>
                    <td></td>
                    <td><b>17</b></td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>Cluster 3</td>
                    <td>14</td>
                    <td>12</td>
                    <td><b>76</b></td>
                </tr>
                <tr>
                    <td>Cluster 4</td>
                    <td></td>
                    <td><b>35</b></td>
                    <td>1</td>
                </tr>
            </table>

            <p>The visualization of clusters shows below.</p>

            <img style="width:95%" class="centerfig" src="picture/cluster/new_1y_kshape_4.png">
            <figurecaption>Figure: visualization of clusters in KShape model using cross-correlation metric</figurecaption>

            <p>The number of clusters of this model is only 4, 2 GPU-dominated clusters and 2 CPU-drive-mixed clusters.</p>

        </section>


        <h2>2. Crypto & Commodity (R Record Data)</h2>

        <h3>2.1 Crypto Time Series</h3>

        <section id="crypto">

        </section>

        <h3>2.2 Commodity Time Series</h3>

        <section id="commodity">

        </section>


        <h2>3. Public View (Python Text Data)</h2>


        <section id="youtube">
            <h3>3.1 KMeans Clustering on YouTube comments (metric: Euclidean, Cosine)</h3>


            <h3>3.2 DBScan Clustering on YouTube comments (metric: Cosine)</h3>


            <h3>3.3 Hierarchical Clustering on YouTube comments (metric: Cosine)</h3>


        </section>

    </div>

</div>

<script src="jquery-3.5.1.min.js"></script>
<script>$(function () {
    $(".headerpage-501").load("header.html");
});</script>
<script src="nav_scroll.js"></script>
</body>
</html>